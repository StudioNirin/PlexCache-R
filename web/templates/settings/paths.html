{% extends "settings/index.html" %}

{% block settings_content %}
<div class="card">
    <div class="card-header">
        <i data-lucide="folder"></i>
        <h2>Path Mappings</h2>
    </div>
    <div class="card-body">
        <p class="text-muted mb-2">Configure how Plex paths map to your filesystem and cache drive.</p>

        <div id="path-mappings">
            {% if mappings %}
                {% for mapping in mappings %}
                {% set index = loop.index0 %}
                {% include "settings/partials/path_mapping_card.html" %}
                {% endfor %}
            {% else %}
                <div class="alert alert-info" id="no-mappings-alert">
                    <i data-lucide="info"></i>
                    No path mappings configured. Run setup wizard or add mappings below.
                </div>
            {% endif %}
        </div>

        <script>
            function toggleEditMode(index) {
                const view = document.getElementById('mapping-view-' + index);
                const edit = document.getElementById('mapping-edit-' + index);
                if (view.style.display === 'none') {
                    view.style.display = 'block';
                    edit.style.display = 'none';
                } else {
                    view.style.display = 'none';
                    edit.style.display = 'block';
                }
                lucide.createIcons();
            }
        </script>

        <hr style="border-color: var(--plex-border); margin: 1.5rem 0;">

        <details>
            <summary style="cursor: pointer; color: var(--plex-orange);">
                <i data-lucide="plus"></i> Add New Path Mapping
            </summary>

            <form hx-post="/settings/paths" hx-target="#path-mappings" hx-swap="beforeend" style="margin-top: 1rem;">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="new_name">Name</label>
                        <input type="text" id="new_name" name="name" placeholder="TV Shows" required>
                    </div>
                    <div class="form-group">
                        <label for="new_plex_path">Plex Path</label>
                        <input type="text" id="new_plex_path" name="plex_path" placeholder="/media/tv" required>
                        <div class="form-hint">Path as seen by Plex (container path)</div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="new_real_path">Real Path</label>
                        <input type="text" id="new_real_path" name="real_path" placeholder="/mnt/user/media/tv" required>
                        <div class="form-hint">Actual filesystem path</div>
                    </div>
                    <div class="form-group">
                        <label for="new_cache_path">Cache Path</label>
                        <input type="text" id="new_cache_path" name="cache_path" placeholder="/mnt/cache/media/tv">
                        <div class="form-hint">Cache drive path (optional)</div>
                    </div>
                </div>

                <div class="flex gap-2 mb-2">
                    <label class="switch">
                        <input type="checkbox" name="cacheable" checked>
                        <span>Cacheable</span>
                    </label>
                    <label class="switch">
                        <input type="checkbox" name="enabled" checked>
                        <span>Enabled</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i data-lucide="plus"></i>
                    Add Path Mapping
                </button>
            </form>
        </details>
    </div>
</div>
{% endblock %}
