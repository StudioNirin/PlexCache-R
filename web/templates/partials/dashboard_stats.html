<!-- Dashboard stats cards - refreshed via HTMX -->
<a href="/cache/drive" class="stat-card stat-card-link">
    <div class="stat-card-header">
        <i data-lucide="hard-drive"></i>
        Cache Drive
    </div>
    <div class="stat-value orange">{{ stats.cache_files }}</div>
    <div class="stat-label">files cached{% if stats.cached_files_size %} ({{ stats.cached_files_size }}){% endif %}</div>
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill {% if stats.eviction_over_threshold %}progress-warning{% endif %}" style="width: {{ stats.usage_percent }}%"></div>
        </div>
        <div class="progress-label">
            <span title="Total drive usage / Drive capacity">{{ stats.cache_size }} / {{ stats.cache_limit }}</span>
            <span>{{ stats.usage_percent }}%</span>
        </div>
    </div>
    {% if stats.cache_limit_exceeded %}
    <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--danger);">
        <i data-lucide="alert-circle" style="width: 12px; height: 12px; vertical-align: middle;"></i>
        Over cache limit — caching paused
    </div>
    {% elif stats.min_free_space_warning %}
    <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--danger);">
        <i data-lucide="alert-circle" style="width: 12px; height: 12px; vertical-align: middle;"></i>
        Below min free space floor — caching paused
    </div>
    {% elif stats.eviction_over_threshold %}
    <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--warning);">
        <i data-lucide="alert-triangle" style="width: 12px; height: 12px; vertical-align: middle;"></i>
        Over eviction threshold by {{ stats.eviction_over_by_display }}
    </div>
    {% endif %}
</a>

<a href="/cache?source=ondeck" class="stat-card stat-card-link">
    <div class="stat-card-header">
        <i data-lucide="play-circle"></i>
        OnDeck
    </div>
    <div class="stat-value">{{ stats.ondeck_count }}</div>
    <div class="stat-label">items ready</div>
</a>

<a href="/cache?source=watchlist" class="stat-card stat-card-link">
    <div class="stat-card-header">
        <i data-lucide="bookmark"></i>
        Watchlist
    </div>
    <div class="stat-value">{{ stats.watchlist_count }}</div>
    <div class="stat-label">items tracked</div>
</a>

<a href="/maintenance" class="stat-card stat-card-link {% if stats.health_issues > 0 %}stat-card-danger{% elif stats.health_warnings > 0 %}stat-card-warning{% else %}stat-card-success{% endif %}"
   title="{% if stats.health_issues > 0 %}{{ stats.health_orphaned_count }} orphaned backup{{ 's' if stats.health_orphaned_count != 1 }}{% endif %}{% if stats.health_warnings > 0 %}{% if stats.health_issues > 0 %}, {% endif %}{% set parts = [] %}{% if stats.health_stale_exclude_count > 0 %}{% set _ = parts.append(stats.health_stale_exclude_count ~ ' stale exclude') %}{% endif %}{% if stats.health_stale_timestamp_count > 0 %}{% set _ = parts.append(stats.health_stale_timestamp_count ~ ' stale timestamp') %}{% endif %}{{ parts|join(', ') }}{% endif %}{% if stats.health_issues == 0 and stats.health_warnings == 0 %}All tracking data is consistent{% endif %}">
    <div class="stat-card-header">
        {% if stats.health_issues > 0 %}
        <i data-lucide="alert-circle"></i>
        {% elif stats.health_warnings > 0 %}
        <i data-lucide="alert-triangle"></i>
        {% else %}
        <i data-lucide="check-circle"></i>
        {% endif %}
        Tracking
    </div>
    {% if stats.health_issues > 0 %}
    <div class="stat-value" style="color: var(--danger);">{{ stats.health_issues }}</div>
    <div class="stat-label">critical issues</div>
    <div class="stat-detail">{{ stats.health_orphaned_count }} orphaned backup{{ 's' if stats.health_orphaned_count != 1 }}</div>
    {% elif stats.health_warnings > 0 %}
    <div class="stat-value" style="color: var(--warning);">{{ stats.health_warnings }}</div>
    <div class="stat-label">warnings</div>
    <div class="stat-detail">
        {% set parts = [] %}
        {% if stats.health_stale_exclude_count > 0 %}{% set _ = parts.append(stats.health_stale_exclude_count ~ ' stale exclude') %}{% endif %}
        {% if stats.health_stale_timestamp_count > 0 %}{% set _ = parts.append(stats.health_stale_timestamp_count ~ ' stale timestamp') %}{% endif %}
        {{ parts|join(', ') }}
    </div>
    {% else %}
    <div class="stat-value" style="color: var(--success);">OK</div>
    <div class="stat-label">no issues</div>
    {% endif %}
</a>

<a href="/settings/schedule" class="stat-card stat-card-link">
    <div class="stat-card-header">
        <i data-lucide="clock"></i>
        Schedule
    </div>
    <div style="text-align: center; margin-bottom: 0.5rem;">
        <div style="font-size: 0.7rem; text-transform: uppercase; color: var(--plex-text-muted); margin-bottom: 0.25rem;">Last Run</div>
        <div style="font-size: 1.5rem; font-weight: 600; color: var(--plex-text);">{{ stats.last_run }}</div>
    </div>
    {% if stats.last_run_summary %}
    <div class="last-run-detail" style="text-align: center; margin-bottom: 0.35rem;">
        {% if stats.last_run_summary.dry_run %}
        <span class="badge badge-muted" style="font-size: 0.65rem;">Dry Run</span>
        {% elif stats.last_run_summary.status == 'failed' %}
        <span class="badge badge-warning" style="font-size: 0.65rem;">Failed</span>
        {% endif %}
        {% if stats.last_run_summary.error_count > 0 %}
        <span style="font-size: 0.7rem; color: var(--warning);">{{ stats.last_run_summary.error_count }} error{{ 's' if stats.last_run_summary.error_count != 1 }}</span>
        {% endif %}
        <div style="font-size: 0.75rem; color: var(--plex-text-muted); margin-top: 0.15rem;">
            {% if stats.last_run_summary.total_bytes_display %}{{ stats.last_run_summary.total_bytes_display }} &middot; {% endif %}{{ stats.last_run_summary.duration_display }}
        </div>
    </div>
    {% endif %}
    <div class="mt-1" style="text-align: center;">
        {% if stats.plex_connected %}
        <span class="badge badge-success">
            <i data-lucide="plug"></i>
            Plex Connected
        </span>
        {% else %}
        <span class="badge badge-warning">
            <i data-lucide="plug-off"></i>
            Plex Not Connected
        </span>
        {% endif %}
    </div>
</a>
